# 网站部署共识文档

## 需求确认

基于用户反馈，已明确以下部署需求：

### 环境策略
- **当前环境**: 生产环境，不可修改现有数据库
- **新建项目**: 创建全新的Supabase生产项目
- **多环境配置**: 开发环境(现有) + 生产环境(新建)

### 平台配置
- **Vercel账户**: 已有账户
- **域名策略**: 使用Vercel默认域名，暂不配置自定义域名
- **自动部署**: 配置GitHub集成的CI/CD自动部署

### 服务集成
- **邮件服务**: 不需要配置
- **第三方服务**: 无其他服务需求

## 技术实现方案

### 1. Supabase生产环境

#### 新项目创建
- 创建新的Supabase项目用于生产环境
- 迁移数据库结构（不包含现有数据）
- 配置生产环境的存储桶和策略
- 部署Edge Functions

#### 环境隔离
- 开发环境：`rtprnlyohcklthvynpjl.supabase.co`（保持不变）
- 生产环境：新建项目URL

### 2. Vercel部署配置

#### 项目设置
- 连接GitHub仓库
- 配置构建命令：`npm run build`
- 配置输出目录：`dist`
- 设置Node.js版本：18.x

#### 环境变量配置
- **开发环境**（Preview）：使用现有Supabase项目
- **生产环境**（Production）：使用新建Supabase项目

### 3. 自动部署流程

#### GitHub集成
- 主分支推送 → 生产环境部署
- 开发分支推送 → 预览环境部署
- Pull Request → 预览环境部署

#### 构建优化
- 启用Vercel的构建缓存
- 配置代码分割优化
- 启用静态资源压缩

## 技术约束

### Supabase限制
- 免费计划：2个项目限制
- 数据库：500MB存储限制
- API请求：50,000次/月
- 存储：1GB文件存储

### Vercel限制
- 免费计划：100GB带宽/月
- 构建时间：45分钟/月
- 函数执行：100GB-Hrs/月
- 部署：3000次/月

### 项目约束
- 保持现有代码结构不变
- 确保开发环境继续正常运行
- 生产环境独立配置

## 集成方案

### 环境变量管理
```bash
# 开发环境 (.env.development)
VITE_SUPABASE_URL=https://rtprnlyohcklthvynpjl.supabase.co
VITE_SUPABASE_ANON_KEY=现有开发环境密钥
VITE_APP_ENV=development

# 生产环境 (.env.production)
VITE_SUPABASE_URL=新建生产项目URL
VITE_SUPABASE_ANON_KEY=新建生产项目密钥
VITE_APP_ENV=production
```

### 构建配置
- 开发构建：使用开发环境变量
- 生产构建：使用生产环境变量
- 预览构建：使用开发环境变量

## 验收标准

### 功能验证
- [ ] 新Supabase项目创建成功
- [ ] 数据库结构迁移完成
- [ ] Vercel项目配置完成
- [ ] 自动部署流程正常
- [ ] 生产环境网站可访问
- [ ] 所有功能正常运行

### 环境隔离验证
- [ ] 开发环境独立运行
- [ ] 生产环境独立运行
- [ ] 环境变量正确配置
- [ ] 数据库访问权限正确

### 部署流程验证
- [ ] GitHub推送触发自动部署
- [ ] 构建过程无错误
- [ ] 部署成功通知
- [ ] 回滚机制可用

## 任务边界

### 包含范围
1. 创建新的Supabase生产项目
2. 配置Vercel项目和自动部署
3. 设置环境变量和多环境配置
4. 迁移数据库结构到生产环境
5. 部署Edge Functions到生产环境
6. 配置存储桶和访问策略
7. 验证部署结果和功能完整性

### 不包含范围
- 现有开发环境的任何修改
- 生产数据的迁移或导入
- 自定义域名配置
- 邮件服务配置
- 监控和日志系统配置
- SSL证书配置（Vercel自动处理）

## 风险控制

### 数据安全
- 不修改现有生产数据库
- 新建独立的生产项目
- 环境变量安全存储

### 部署安全
- 分阶段部署验证
- 保留回滚能力
- 构建失败自动停止

### 访问控制
- Supabase项目权限管理
- Vercel团队访问控制
- GitHub仓库权限设置

## 成功指标

### 性能指标
- 首屏加载时间 < 3秒
- 构建时间 < 5分钟
- 部署时间 < 3分钟

### 可用性指标
- 网站可用性 > 99%
- API响应时间 < 500ms
- 错误率 < 1%

### 开发效率指标
- 自动部署成功率 > 95%
- 从提交到部署 < 10分钟
- 环境切换无缝衔接

---

**确认状态**: ✅ 已确认
**创建时间**: 2024年1月
**文档版本**: v1.0
**下一阶段**: 架构设计